@{
    ViewBag.Title = "医保目录对码";
    Layout = "~/Views/Shared/_Admission.cshtml";
}


<form id="form1">
    <input type="hidden" id="empid" value="@ViewBag.empid" />
    <div style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <ul class="nav nav-tabs">
            <li><a href="#">HIS端目录</a></li>
            <li><a href="javascript:void()">医保端目录</a></li>
            <li class="active"><a href="javascript:void()">目录对照管理</a></li>
            <li><a href="javascript:void()">中心端目录对照结果查询</a></li>
            <li><a href="javascript:void()">异地诊疗材料对照</a></li>
        </ul>
        <div class="topPanel">
            <div class="search">
                <table>
                    <tr>
                        <td>
                            <div id="txt_condition" class="btn-group">
                                <a class="btn btn-default dropdown-text" data-toggle="dropdown">目录类别</a>
                                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="#" data-value="1">药品</a></li>
                                    <li><a href="#" data-value="2">诊疗项目</a></li>
                                    <li><a href="#" data-value="3">服务设施</a></li>
                                    <li><a href="#" data-value="4">材料</a></li>
                                </ul>
                            </div>
                        </td>
                        <th class="formTitle" style="padding-left: 12px;">目录编码</th>
                        <td style="padding-left: 12px;">
                            <div class="input-group">
                                <input id="txt_code" type="text" class="form-control" placeholder="请输入目录编码">
                            </div>
                        </td>
                        <th class="formTitle" style="padding-left: 12px;">目录名称</th>
                        <td style="padding-left: 12px;">
                            <div class="input-group">
                                <input id="txt_name" type="text" class="form-control" placeholder="请输入目录名称">
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="toolbar">
                <div class="btn-group" id="btn_search">
                    <a class="btn btn-default">查询</a>
                </div>
                <div class="btn-group" id="btn_reset">
                    <a class="btn btn-default">重置</a>
                </div>
                <div class="btn-group">
                    <a id="NF-add" authorize="yes" class="btn btn-primary" onclick="btn_update()"><i class="fa fa-plus"></i>更新目录</a>
                </div>
            </div>
        </div>
        <div class="gridPanel">
            <table id="gridList"></table>
            <div id="gridPager"></div>
        </div>
    </div>
</form>

<script>
    $(function () {
        
        $("#txt_condition .dropdown-menu li").click(function () {
            var text = $(this).find('a').html();
            var value = $(this).find('a').attr('data-value');
            $("#txt_condition .dropdown-text").html(text).attr('data-value', value)
        });
        var userId = $('#empid').val();

        gridList3(userId);
    })

    //HIS基层三大目录
    function gridList(userId) {
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            url: "/BenDing/QueryCatalog",
            height: $(window).height() - 128,
            colModel: [
                //{ label: "主键", name: "Id", hidden: true, key: true },
                //{ label: 'ID', name: 'Id', width: 300, align: 'left'},
                { label: '医保目录编码', name: 'DirectoryCode', width: 300, align: 'left'},
                { label: '医保目录名称', name: 'DirectoryName', width: 300, align: 'left'},
                { label: '单位', name: 'Unit', width: 100, align: 'left' },
                { label: '规格', name: 'Specification', width: 100, align: 'left'},
                { label: '剂型', name: 'Formulation', width: 100, align: 'left'},
                { label: '生产厂家', name: 'ManufacturerName', width: 200, align: 'left'},
                { label: '目录类别名称', name: 'DirectoryCategoryName', width: 100, align: 'left' },
                { label: '助记码', name: 'MnemonicCode', width: 300, align: 'left' },
                { label: '备注', name: 'Remark', width: 100, align: 'left' },
                {
                    label: '创建时间', name: 'DirectoryCreateTime',
                    formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }
                }
            ],
            pager: "#gridPager",
            sortname: 'DirectoryCreateTime desc',
            shrinkToFit: false,
            autoScroll: true,
            viewrecords: true
        });
    

        //$("#time_horizon a.btn-default").click(function () {
        //    $("#time_horizon a.btn-default").removeClass("active");
        //    $(this).addClass("active");
        //    $('#btn_search').trigger("click");
        //});
        //$("#btn_search").click(function () {
        //    var timeType = $("#time_horizon a.active").attr('data-value');
        //    var queryJson = {
        //        keyword: $("#txt_keyword").val(),
        //        timeType: $("#time_horizon a.active").attr('data-value'),
        //    }
        //    $gridList.jqGrid('setGridParam', {
        //        postData: { queryJson: JSON.stringify(queryJson) },
        //    }).trigger('reloadGrid');
        //});
    }
    //医保中心三大目录
    function gridList2(userId) {
        var $gridList = $("#gridList");
        var queryJson = {
            UserId: userId,
            ProjectName: projectName
        };
        var param = "?UserId=" + queryJson.UserId + "&ProjectName=" + queryJson.ProjectName;
        $gridList.dataGrid({
            url: "/BenDing/QueryProjectDownload",
            queryParams: param,
            height: $(window).height() - 128,
            colModel: [
                //{ label: 'ID', name: 'Id', width: 300, align: 'left' },
                { label: '收费项目编码', name: 'ProjectCode', width: 300, align: 'left' },
                { label: '收费项目名称', name: 'ProjectName', width: 300, align: 'left' },
                { label: '分类代码', name: 'ProjectCodeType', width: 300, align: 'left' },
                { label: '收费项目等级', name: 'ProjectLevel', width: 100, align: 'left' },
                { label: '单位', name: 'Unit', width: 100, align: 'left' },
                { label: '拼音助记码', name: 'MnemonicCode', width: 300, align: 'left' },
                { label: '剂型', name: 'Formulation', width: 100, align: 'left' },
                { label: '限制用药标志', name: 'RestrictionSign', width: 100, align: 'left' },
                { label: '生产厂家', name: 'Manufacturer', width: 200, align: 'left' },
                { label: '药品准字号', name: 'QuasiFontSize', width: 100, align: 'left' },
                { label: '规格', name: 'Specification', width: 100, align: 'left' },
                { label: '备注', name: 'Remark', width: 100, align: 'left' },
                { label: '新码标志', name: 'NewCodeMark', width: 100, align: 'left' },
                { label: '限制支付范围', name: 'LimitPaymentScope', width: 100, align: 'left' },
                {
                    label: '变更日期', name: 'NewUpdateTime',
                    formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }
                }
            ],
            pager: "#gridPager",
            //sortname: 'NewUpdateTime desc',
            shrinkToFit: false,
            autoScroll: true,
            viewrecords: true
        });


        //$("#time_horizon a.btn-default").click(function () {
        //    $("#time_horizon a.btn-default").removeClass("active");
        //    $(this).addClass("active");
        //    $('#btn_search').trigger("click");
        //});
        //$("#btn_search").click(function () {
        //    var timeType = $("#time_horizon a.active").attr('data-value');
        //    var queryJson = {
        //        keyword: $("#txt_keyword").val(),
        //        timeType: $("#time_horizon a.active").attr('data-value'),
        //    }
        //    $gridList.jqGrid('setGridParam', {
        //        postData: { queryJson: JSON.stringify(queryJson) },
        //    }).trigger('reloadGrid');
        //});
    }
    //目录对照管理 前面部分是HIS，后部分是医保中心数据
    function gridList3(userId) {
        var $gridList = $("#gridList");
        var param = {
            UserId: userId
        };
        $gridList.dataGrid({
            url: "/BenDing/DirectoryComparisonManagement",
            queryParams: param,
            height: $(window).height() - 128,
            colModel: [
                {
                    label: '对码', name: 'DirectoryName', index: 'DirectoryName', width: 80, align: "center", sortable: false, edittype: "button", sortable: false,
                    formatter: function (index) {
                        return '<a id="NF-add" class="btn btn-default" onclick="btn_modulebutton(\'' + index+'\')"><i class="fa fa-plus"></i></a>';
                    }
                },
                { label: '目录编码', name: 'DirectoryCode', width: 300, align: 'left' },
                { label: '目录名称', name: 'DirectoryName', width: 300, align: 'left' },
                { label: '助记码', name: 'MnemonicCode', width: 300, align: 'left' },
                { label: '目录类别名称', name: 'DirectoryCategoryName', width: 100, align: 'left' },
                { label: '单位', name: 'Unit', width: 100, align: 'left' },
                { label: '规格', name: 'Specification', width: 100, align: 'left' },
                { label: '剂型', name: 'Formulation', width: 100, align: 'left' },
                { label: '生产厂家', name: 'ManufacturerName', width: 200, align: 'left' },

                { label: '医保项目编码', name: 'ProjectCode', width: 300, align: 'left' },
                { label: '医保项目名称', name: 'ProjectName', width: 300, align: 'left' },
                { label: '医保限制使用范围', name: 'LimitPaymentScope', width: 100, align: 'left' },
                { label: '医保准字号', name: 'QuasiFontSize', width: 100, align: 'left' },
                { label: '医保类别', name: 'ProjectCodeType', width: 100, align: 'left' },
                { label: '医保报销比例', name: 'ProjectLevel', width: 100, align: 'left' },
                { label: '医保备注', name: 'Remark', width: 100, align: 'left' },
                { label: '对码操作人员', name: 'PairCodeUser', width: 100, align: 'left' },
                {
                    label: '对码时间', name: 'PairCodeTime',
                    formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }
                }
            ],
            pager: "#gridPager",
            sortname: 'PairCodeTime desc',
            shrinkToFit: false,
            autoScroll: true,
            viewrecords: true
        });

        $("#btn_search").click(function () {
            $gridList.jqGrid('setGridParam', {
                postData: {
                    DirectoryCategoryCode: $("#txt_condition").find('.dropdown-text').attr('data-value'),
                    State: "0",//$("#txt_condition").find('.dropdown-text').attr('data-value'),
                    DirectoryName: $("#txt_name").val(),
                    DirectoryCode: $("#txt_code").val(),
                    UserId: $('#empid').val()
                   }
            }).trigger('reloadGrid');
        });


    }
    //对码
    function btn_modulebutton(DirectoryName) {
        //var type = $("#txt_condition").find('.dropdown-text').attr('data-value');
        var userId = $('#empid').val();
        var layer = layui.layer;
        layer.open({
            type: 2,
            area: ['1200px', '600px'],
            fixed: false, //不固定
            title: "药品对照",
            maxmin: false,
            shade: [0.8, '#DDDDDD'],
            content: "/BenDing/MedicalDirectoryPairCode?UserId=" + userId + "&ProjectName=" + DirectoryName
        });
    }

</script>