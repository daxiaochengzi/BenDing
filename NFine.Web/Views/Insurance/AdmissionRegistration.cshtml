@{
    ViewBag.Title = "医保入院登记";
    Layout = "~/Views/Shared/_Admission.cshtml";
}


<form id="form1">
    <input type="hidden" id="bid" value="@ViewBag.bid" />
    <input type="hidden" id="empid" value="@ViewBag.empid" />
    <div class="topPanel" style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <div class="search">
            <table>
                <tr>
                    <td>
                        <div id="txt_condition" class="btn-group">
                            <a class="btn btn-default dropdown-text" data-toggle="dropdown">选择条件</a>
                            <a class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#" data-value="1">身份证号</a></li>
                                <li><a href="#" data-value="2">个人编号</a></li>
                                <li><a href="#" data-value="3">住院编号</a></li>
                            </ul>
                        </div>
                    </td>
                    <td style="padding-left: 12px;">
                        <div class="input-group">
                            <input id="txt_keyword" type="text" class="form-control" placeholder="请输入身份证号/个人编号/住院编号" style="width: 300px;">
                            <span class="input-group-btn">
                                <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a href="#">城乡居保</a></li>
            <li role="presentation"><a href="#">城镇职工</a></li>
            <!--
            PO_XZLX	险种类型
            310:城镇职工基本医疗保险
            342：城乡居民基本医疗保险
            -->
        </ul>
        <div style="padding-top: 10px; margin-right: 30px;margin-bottom: 10px;">
            <table class="form">
                <tr>
                    <th class="formTitle">住院编号</th>
                    <td class="formValue">
                        <input id="PI_YYZYH_Id" name="HospitalizationNo" type="text" class="form-control required" placeholder="请输入住院号" />
                    </td>
                    <th class="formTitle">患者姓名</th>
                    <td class="formValue">
                        <input id="PO_XM_Id" name="PatientName" type="text" class="form-control required" placeholder="请输入患者姓名" />
                    </td>

                    <th class="formTitle">医疗类别</th>
                    <td class="formValue">
                        <select id="F_YLLBCategoryId" name="F_Target" class="form-control required">
                            <option value="">==请选择==</option>
                            <option value="11">11-普通入院</option>
                            <option value="14">14-大病门诊</option>
                            <option value="15">15-大病住院</option>
                            <option value="22">22-急诊入院</option>
                            <option value="23">23-市内转院住院</option>
                            <option value="41">41-病理剖宫产</option>
                            <option value="71">71-顺产</option>
                            <option value="72">72-剖宫产</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <!--
                        PI_SFBZ 身份标志 : 个人编号或身份证号
                        PI_CRBZ 传入标志 : 1为公民身份号码 2为个人编号
                    -->
                    <th class="formTitle">个人编号</th>
                    <td class="formValue">
                        <input id="PI_CRBZ_1" name="PI_SFBZ_1" type="text" class="form-control" placeholder="请输入个人编号" />
                    </td>
                    <th class="formTitle">身份证号</th>
                    <td class="formValue">
                        <input id="PI_CRBZ_2" name="IdCardNo" type="text" class="form-control" placeholder="请输入身份证号" />
                    </td>
                    <th class="formTitle">户口性质</th>
                    <!--如果为生育入院（即就诊类别为71，72，41）的，需录入产妇的户口性质。-->
                    <td class="formValue">
                        <select id="PI_HKXZ_ID" name="PI_HKXZ" class="form-control required">
                            <option value="">==请选择==</option>
                            <option value="10">10-城镇户口</option>
                            <option value="20">20-农业户口</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">入院日期</th>
                    <!--格式为YYYYMMDD-->
                    <td class="formValue">
                        <input id="PI_RYRQ_Id" name="AdmissionDate" type="text" class="form-control input-wdatepicker" onfocus="WdatePicker()" placeholder="请选择入院日期" />
                    </td>
                    <th class="formTitle">住院科室</th>
                    <td class="formValue">
                        <input id="PI_ZYBQ_Name" name="InDepartmentName" type="text" class="form-control" />
                        <input id="PI_ZYBQ_Id" name="InDepartmentId" type="hidden" class="form-control" />
                    </td>
                    <th class="formTitle">床位号</th>
                    <td class="formValue">
                        <input id="PI_CWH_Id" name="AdmissionBed" type="text" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">入院费别</th>
                    <td class="formValue">
                        <select id="F_CategoryId" name="F_Target" class="form-control required">
                            <option value="">==请选择==</option>
                            <option value="1">1-记账病人</option>
                            <option value="2">2-记账病人</option>
                            <option value="3">3-工伤保险</option>
                            <option value="5">5-其他</option>
                            <option value="6">6-县社保病人</option>
                            <option value="7">7-市社保病人</option>
                            <option value="8">8-绿色通道</option>
                            <option value="9">9-新农合病人</option>
                        </select>
                    </td>
                    <th class="formTitle">病员分类</th>
                    <td class="formValue">
                        <select id="" name="F_Target" class="form-control required">
                            <option value="">==请选择==</option>
                            <option value="0001">0001-自费</option>
                            <option value="0002">0002-医保病人</option>
                            <option value="0003">0003-新农合病人</option>
                        </select>
                    </td>
                    <!--如果为生育入院（即就诊类别为71，72，41）的，需录入生育的胎儿数量-->
                    <th class="formTitle">胎儿数</th>
                    <td class="formValue">
                        <input id="PI_TES_Id" name="PI_TES" type="text" class="form-control" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="topPanel">
        <div class="search">
            <table>
                <tr>
                    <td>
                        <div>
                            <span>录入诊断</span>
                        </div>
                    </td>
                    <td>
                        <div style="padding-left: 10px;" class="input-group">
                            <input type="text" id="idc10_search_text" class="form-control" placeholder="请输入诊断关键字" style="width: 200px;">
                            <span class="input-group-btn">
                                <button id="idc10_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="gridPanel">
        <style>
            .ui-jqgrid {
                border-left: 0px;
                border-right: 0px;
                border-bottom: 0px;
            }
        </style>
        <div class="ui-jqgrid" style="width: 902px;">
            <div class="ui-jqgrid-view table-responsive" role="grid" id="gview_gridList" style="width: 902px;">
                <div class="ui-jqgrid-titlebar ui-jqgrid-caption" style="display: none;"><span class="ui-jqgrid-title"></span></div>
                <div class="ui-jqgrid-hdiv" style="width: 900px;">
                    <div class="ui-jqgrid-hbox">
                        <table class="ui-jqgrid-htable ui-common-table table table-bordered" style="width:900px" role="presentation" aria-labelledby="gbox_gridList">
                            <thead>
                                <tr class="ui-jqgrid-labels" role="row">
                                    <th id="gridList_rn" style="text-align: center; width: 100px;" role="columnheader" class="ui-th-column ui-th-ltr ">
                                        <div class="ui-th-div" id="jqgh_gridList_rn">行号</div>
                                    </th>
                                    <th id="gridList_F_Id" style="text-align: left;width: 200px;" role="columnheader" class="ui-th-column ui-th-ltr ">
                                        <span class="ui-jqgrid-resize ui-jqgrid-resize-ltr" style="cursor: col-resize;">&nbsp;</span>
                                        <div class="ui-th-div ui-jqgrid-sortable" id="jqgh_gridList_F_Id">
                                            诊断代码
                                            <span class="s-ico" style="display:none"></span>
                                        </div>
                                    </th>
                                    <th id="gridList_F_FullName" style="text-align: left; width: 400px;" role="columnheader" class="ui-th-column ui-th-ltr">
                                        <span class="ui-jqgrid-resize ui-jqgrid-resize-ltr" style="cursor: col-resize;">&nbsp;</span>
                                        <div class="ui-th-div ui-jqgrid-sortable" id="jqgh_gridList_F_FullName">
                                            诊断名称
                                            <span class="s-ico" style="display:none"></span>
                                        </div>
                                    </th>
                                    <th id="gridList_F_Location" style="text-align: left; width: 100px;" role="columnheader" class="ui-th-column ui-th-ltr">
                                        <span class="ui-jqgrid-resize ui-jqgrid-resize-ltr" style="cursor: col-resize;">&nbsp;</span>
                                        <div class="ui-th-div ui-jqgrid-sortable" id="jqgh_gridList_F_Location">
                                            结果
                                            <span class="s-ico" style="display:none"></span>
                                        </div>
                                    </th>
                                    <th id="gridList_F_JsEvent" style="text-align: left; width: 100px;" role="columnheader" class="ui-th-column ui-th-ltr">
                                        <span class="ui-jqgrid-resize ui-jqgrid-resize-ltr" style="cursor: col-resize;">&nbsp;</span>
                                        <div class="ui-th-div ui-jqgrid-sortable" id="jqgh_gridList_F_JsEvent">
                                            主诊
                                            <span class="s-ico" style="display:none"></span>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                        </table>
                    </div>

                </div>
                <div class="ui-jqgrid-bdiv" style="height: 450px; width: 900px;">
                    <div style="position:relative;">
                        <div></div>
                        <table id="gridList" tabindex="0" role="presentation" aria-multiselectable="false" aria-labelledby="gbox_gridList" class="ui-jqgrid-btable ui-common-table table table-bordered" style="width: 900px;">
                            <tbody>
                                <tr class="jqgfirstrow" role="row">
                                    <td role="gridcell" style="height:0px;width:100px;"></td>
                                    <td role="gridcell" style="height:0px;width:200px;"></td>
                                    <td role="gridcell" style="height:0px;width:400px;"></td>
                                    <td role="gridcell" style="height:0px;width:100px;"></td>
                                    <td role="gridcell" style="height:0px;width:100px;"></td>
                                </tr>
                                <tr role="row" id="5d708d9d-6ebe-40ea-8589-e3efce9e74ec" tabindex="-1" class="jqgrow ui-row-ltr">
                                    <td role="gridcell" style="text-align:center;" class="jqgrid-rownum " title="" aria-describedby="gridList_rn">1</td>
                                    <td role="gridcell" style="text-align:left;" title="" aria-describedby="gridList_F_FullName">K83.007</td>
                                    <td role="gridcell" style="text-align:left;" title="" aria-describedby="gridList_F_Location">复发性胆管炎</td>
                                    <td role="gridcell" style="text-align:left;" title="" aria-describedby="gridList_F_JsEvent">好转</td>
                                    <td role="gridcell" style="text-align:left;" title="" aria-describedby="gridList_F_UrlAddress">主诊</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    $(function () {
        //loading ...
        
        var userId = $("#empid").val();
        var bid = $("#bid").val();



        $("#txt_condition .dropdown-menu li").click(function () {
            var text = $(this).find('a').html();
            var value = $(this).find('a').attr('data-value');
            $("#txt_condition .dropdown-text").html(text).attr('data-value', value)
        });
        //身份证查询--> form数据回显
        $("#btn_search").click(function () {
            var queryJson = {
                condition: $("#txt_condition").find('.dropdown-text').attr('data-value'),
                keyword: $("#txt_keyword").val()
            }
            //$gridList.jqGrid('setGridParam', {
            //    postData: { queryJson: JSON.stringify(queryJson) },
            //}).trigger('reloadGrid');
            if (!!queryJson) {
                $.ajax({
                    url: "/BenDing/GetInpatientInfo",
                    data: {
                        "UserId": userId,
                        "IdCardNo": queryJson.keyword,
                        "BusinessId": bid,
                        "StartTime": "2019-09-16 11:09:00",
                        "EndTime": "2019-09-20 11:09:00",
                        "State":"0"
                    },
                    type: "POST",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        console.log(data.Data);
                        //$("#form1").formSerialize(data);
                        jsonToForm(data.Data, "form1");
                    }
                });
            }
        });
        //form数据回显
        var jsonToForm = function (jsonData, formId) {
            var serializeArray = $("#" + formId).serializeArray();
            for (var i = 0; i < serializeArray.length; i++) {
                var name = serializeArray[i].name;
                if (jsonData[name]) {
                    var value = jsonData[name];
                    $("[name='" + name + "']").val(value);
                }
            }
        };
         //QueryICD10 诊断查询
       


    })
</script>